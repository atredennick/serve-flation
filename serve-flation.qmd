---
title: "Analysis of serve-flation"
author: "Andrew Tredennick"
format: html
---

## Libraries

```{r libraries}
library(tidyverse)
library(here)
library(arrow)
```


## Load and tidy serve speed data from *deuce* package

### Load data
```{r data}
serve_data <- read_parquet(here("data", "serve_data.parquet"))
```

### Filter data to WTA (Women's Tennis Association) Tour
```{r wta}
iga_points <- serve_data |>
  filter(str_detect(player1, "Swiatek") | str_detect(player2, "Swiatek")) |>
  filter(Speed_KMH > 0 & !is.na(Speed_KMH)) |>
  mutate(PointServer = case_when(
    PointServer == 1 ~ player1,
    PointServer == 2 ~ player2,
    TRUE ~ NA_character_
  )) |>
  dplyr::select(match_id, slam, year, server = PointServer, speed_kmh = Speed_KMH) |>
  mutate(server = case_when(
    str_detect(server, "Swiatek") ~ "Iga",
    TRUE ~ "field")
  ) |>
  filter(year > 2020, slam %in% c("usopen", "wimbledon"))

ggplot(iga_points, aes(x = factor(year), y = speed_kmh, color = server)) +
  geom_point(position = position_dodge(1)) +
  geom_boxplot(position = position_dodge(1), alpha = 0.2) +
  facet_wrap(~slam)

lm(speed_kmh ~ server*factor(year), data = iga_points) |> summary()
```

### Filter to first serves
```{r serves}
serves <- iga |>
  dplyr::mutate(ServeNumber = ifelse((is.na(ServeNumber) |
                                        ServeNumber == 0) &
                                       (P1FirstSrvIn == 1 | P2FirstSrvIn == 1),
                                     1,
                                     ifelse((is.na(ServeNumber) |
                                               ServeNumber == 0), 2, ServeNumber)
  ))
```


```{r}
1 + 1
```

You can add options to executable code like this 

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).
